{% extends "base.html" %}
{% block title %}Crear orden{% endblock %}
{% block content %}

<h1>Crear orden</h1>

<form method="post">
  {% csrf_token %}
  <div class="mb-3">
    <label for="evento">Evento:</label>
    <select name="evento" id="evento" class="form-select" required>
      <option value="">-- Seleccionar evento --</option>
      {% for e in eventos %}
        <option value="{{ e.id }}">{{ e.nombre }}</option>
      {% endfor %}
    </select>
  </div>

  <div id="tipos-container"></div>

  <div class="mb-3">
    <label>Email comprador:</label>
    <input type="email" name="email" class="form-control" required>
  </div>

  <button type="submit" class="btn btn-success">Generar tickets</button>
</form>

<script>
document.getElementById('evento').addEventListener('change', async (ev) => {
  const eventoId = ev.target.value;
  const cont = document.getElementById('tipos-container');
  cont.innerHTML = '';
  if (!eventoId) return;

  // Carga tipos por AJAX (DRF opcional, o vista simple)
  const res = await fetch(`/tickets/${eventoId}/json/`);
  const tipos = await res.json();

  tipos.forEach(t => {
    const row = document.createElement('div');
    row.className = 'mb-2';
    row.innerHTML = `
      <label>${t.nombre}</label>
      <input type="number" min="0" max="20" name="cantidad_${t.id}" value="0" class="form-control form-control-sm" style="width:100px;">
    `;
    cont.appendChild(row);
  });
});
</script>

{% endblock %}
