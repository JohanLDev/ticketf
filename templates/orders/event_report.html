<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Informe — {{ evento.nombre }}</title>
  <style>
    /* xhtml2pdf soporta CSS básico */
    body { font-family: DejaVu Sans, Arial, sans-serif; font-size: 12px; color: #222; }
    h1, h2, h3 { margin: 6px 0; }
    h1 { font-size: 20px; }
    h2 { font-size: 16px; }
    h3 { font-size: 14px; }
    .muted { color: #666; }
    .section { margin-top: 14px; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background: #f2f2f2; }
    .kpis { width: 100%; }
    .kpis td { border: 0; padding: 4px 6px; }
    .box { border: 1px solid #ddd; padding: 8px; }
    .bar { width: 100%; height: 16px; background: #eee; border: 1px solid #ccc; }
    .fill { height: 100%; background: #2e7d32; }
    .right { text-align: right; }
    .small { font-size: 11px; }
  </style>
</head>
<body>
  <h1>Informe de evento</h1>
  <div class="muted small">
    Generado: {{ ahora|date:"Y-m-d H:i" }}
  </div>

  <div class="section box">
    <h2>{{ evento.nombre }}</h2>
    {% if evento.fecha_inicio %}
      <div class="small">Fecha inicio: {{ evento.fecha_inicio }}</div>
    {% endif %}
    {% if evento.ubicacion %}
      <div class="small">Ubicación: {{ evento.ubicacion }}</div>
    {% endif %}
  </div>

  <div class="section box">
    <h3>Resumen</h3>
    <table class="kpis">
      <tr>
        <td><b>Tickets emitidos</b></td><td class="right">{{ resumen.emitidos }}</td>
      </tr>
      <tr>
        <td><b>Tickets validados</b></td><td class="right">{{ resumen.validados }}</td>
      </tr>
      <tr>
        <td><b>Tickets anulados</b></td><td class="right">{{ resumen.anulados }}</td>
      </tr>
      <tr>
        <td><b>Asistencia</b></td><td class="right">{{ resumen.asistencia }}%</td>
      </tr>
      <tr>
        <td colspan="2">
          <!-- Barra KPI de asistencia (sin JS) -->
          <div class="bar">
            <div class="fill" style="width: {{ resumen.asistencia }}%;"></div>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <div class="section box">
    <h3>Distribución por tipo (emitidos)</h3>
    <table>
      <thead><tr><th>Tipo</th><th class="right">Cantidad</th></tr></thead>
      <tbody>
        {% for t in tipos_data %}
          <tr>
            <td>{{ t.tipo__nombre }}</td>
            <td class="right">{{ t.total }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="2" class="small muted">Sin datos</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="section box">
    <h3>Validados por tipo</h3>
    <table>
      <thead><tr><th>Tipo</th><th class="right">Validados</th></tr></thead>
      <tbody>
        {% for v in validados_por_tipo %}
          <tr>
            <td>{{ v.tipo__nombre }}</td>
            <td class="right">{{ v.total }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="2" class="small muted">Sin datos</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="section box">
    <h3>Validaciones por día</h3>
    <table>
      <thead><tr><th>Día</th><th class="right">Validaciones</th></tr></thead>
      <tbody>
        {% for d in validados_por_dia %}
          <tr>
            <td>{{ d.dia|date:"Y-m-d" }}</td>
            <td class="right">{{ d.total }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="2" class="small muted">Sin datos</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="section small muted">
    * Informe generado automáticamente por Ticket-F.
  </div>
</body>
</html>
