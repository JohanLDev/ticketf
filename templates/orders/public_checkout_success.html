<!doctype html>
<html>
  <head><meta charset="utf-8"><title>Orden #{{ orden.id }} — Éxito</title></head>
  <body>
    <h1>¡Compra creada!</h1>
    <p><b>Orden:</b> #{{ orden.id }}</p>
    <p><b>Evento:</b> {{ orden.evento.nombre }} ({{ orden.evento.slug }})</p>
    <p><b>Comprador:</b> {{ orden.comprador_email }}</p>

    <h2>Tickets</h2>
    <ul>
      {% for t in tickets %}
        <li>ID {{ t.id }} — {{ t.tipo.nombre }} — Código {{ t.code }}</li>
      {% endfor %}
    </ul>

    <hr>
    <p>
        <a href="{% url 'orders:public-order-pdf' orden.id %}">
            <button>Descargar PDF</button>
        </a>
    </p>

    <p>
        <a href="{% url 'orders:public-event' orden.evento.slug %}">Volver al evento</a>
        
    </p>

  <script>
  (() => {
    // slug del evento desde el contexto correcto
    const slug = "{{ orden.evento.slug }}";

    // limpia el estado del checkout
    const KEYS = [
      'checkout_cart',
      'checkout_totals',
      'checkout_payload',
      'checkout_promo',
      'checkout_buyer',
    ];
    KEYS.forEach(k => sessionStorage.removeItem(k));

    // marca que quedó limpio para este evento (lo usa Step 1)
    sessionStorage.setItem('checkout_cleared_for', slug);
  })();
  </script>

  </body>
</html>
